<!DOCTYPE html>
<html lang="en">
<head> 
	<title></title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="language" content="de" />
	<meta name="author" content="" />
	<meta name="robots" content="index, follow" />
	<meta name="keywords" content="" />
    <meta name="description" content="" />

 	<meta name="viewport" content="width=device-width; initial-scale=1.0">

 	<link rel="shortcut icon" href="img/favicon.ico" />
 		
	<script src="http://www.google.com/jsapi?key=ABQIAAAA-aA-cQ-Dt_eOXMt2cABhzRQvRPGmAZu-tlfdhJELAgtO16tnWxRtu6M5pPKTlkg0fzoFpSutd24Z6A" type="text/javascript"></script>
	<!--
	Default: load JQuery from google library 
    http://code.google.com/intl/de-DE/apis/ajaxlibs/
    -->
    <script type="text/javascript">
  		google.load("jquery", "1");
  		google.load("jqueryui", "1");
	</script>

	<style>
		body { color:#FFFFFF; background:#666666; }
		canvas { background:#FFFFFF; margin-left:20%; margin-top:10%; }
	</style>

</head>
<body id="body">

Html5 / Javascript Jump&amp;Run game. <a href="http://www.weberdevelopment.de" target="_blank">weberdevelopment.de</a>
<p>Just for fun and learning experiences :) and not done yet !</p>

<script type="text/javascript">
		
		  var canvas;
  		var context;

  		var HEIGHT;
  		var WIDTH;

  		var counter;
  		var hero;
  		var level;
  		var bg_cloud;

 		function Player(ctx, canvas) {

			this.width = 40;			
			this.height = 54;

			this.ctx = ctx;

			this.posX = 40;//(canvas.width / 2) - (this.width / 2);
			this.posY = canvas.height - this.height;

			this.img = new Image();
  			this.img.src = "guy.png";

 			this.SPEED = 2;

			this.jumpHeight = 100;
			this.halfPI = Math.PI / 2;
	    	/** The amount of time to spend in the air when jumping */
		    this.jumpHangTime = 0.5;
	        /** The speed to progress alone the sine wave that defines the jumping arc */
	        this.jumpSinWaveSpeed = this.halfPI / this.jumpHangTime;
	        /** The current position on the sine wave that defines the jump arc */
	        this.jumpSinWavePos = 0;
	        /** The rate to fall at */
	        this.fallMultiplyer = 1.5;
	        /** True when the player is on the ground, false otherwise */
	        this.grounded = true;
	        /** True if the player is moving left, false otherwise */
	        this.left = false;
	        /** True if the player is moving right, false otherwise */
	        this.right = false;
	        /** A reference to the level object */
	        this.level = null;

	        this.dt = 0.02;

          this.blockGround = canvas.height;

	        // ------------------------------------------------------
	        this.draw = function() {

	        	// LEFT & RIGHT
		    	if (this.left) {
              		this.posX -= this.SPEED;
              		this.img.src = "guyLeft.png";
              	}
           		if (this.right) {
               		this.posX += this.SPEED;
               		this.img.src = "guy.png";
               	}

		        // JUMP
			  	if (!this.grounded)
		       	{
		            // the last position on the sine wave
		            var lastHeight = this.jumpSinWavePos;
		            // the new position on the sine wave
		            this.jumpSinWavePos += this.jumpSinWaveSpeed * this.dt;
		               
		            // we have fallen off the bottom of the sine wave, so continue falling
		            // at a predetermined speed
		            if (this.jumpSinWavePos >= Math.PI)
		        		this.posY += this.jumpHeight / this.jumpHangTime * this.fallMultiplyer * this.dt;
		            // otherwise move along the sine wave
		            else
		            	this.posY -= (Math.sin(this.jumpSinWavePos) - Math.sin(lastHeight)) * this.jumpHeight;
		           
			    	    // we have hit the ground
				        if (this.posY + this.height >= this.blockGround) {
		               		this.posY = this.blockGround - this.height;
		               		this.grounded = true;
		               		this.jumpSinWavePos = 0;
		           	}
		           	// otherwise we are falling
		           	else if (this.grounded) {		           			
		               		this.grounded = false;
		               		// starting falling down the sine wave (i.e. from the top)
		               		this.jumpSinWavePos = this.halfPI;
		           	}
           		}
	   			
	   			this.blockGround = canvas.height;
	   			// DRAW HERO
	   			this.ctx.drawImage(this.img, this.posX , this.posY);
	        }

		}


		function Block(ctx, canvas, _x) {
			
			this.random = function( min, max ) {
				if( min > max ) {
					return( -1 );
				}
				if( min == max ) {
					return( min );
				}
 
       			return( min + parseInt( Math.random() * ( max-min+1 ) ) );
			}
			var rnd = this.random(0,4);
      //var rnd2 = this.random(0,4);

			var blockWidths = [ 100, 150, 200, 300];
			var blockHeights = [ 20, 60, 100, 140 ];
			var blockColors = [ "#880000", "#008800", "#000088", "#880088" ];
			
      this.color = blockColors[rnd];      
      this.width = blockWidths[rnd];
      this.height = blockHeights[rnd];

			this.x = _x;


      this.img = new Image();
      this.img.src = "block300_100.png";
			
			this.y = canvas.height - this.height;
			this.ctx = ctx;

			this.speed = 2;

			this.draw = function(levelSpeed) {

			      this.x -= this.speed + levelSpeed;

				    //this.ctx.fillStyle = this.color;
            this.ctx.drawImage(this.img, this.x , this.y, this.width, this.height);
        		//this.ctx.fillRect (this.x, this.y, this.width, this.height);

        		if(this.x + this.width < 0)
        			this.speed = 0;
        	}

		}


		function Level(ctx, canvas) {
			
			this.ctx = ctx;
			this.canvas = canvas;

			this.lastBlock = null;
			this.blocks = new Array;

			this.hero = new Player(context, canvas);
			this.speed = 0.0001;

			const BLOCK_GAP = 160;

			this.generateBlock = function() {	
				
				var nextX = this.canvas.width;
				if(this.blocks.length > 0) {
					nextX = this.blocks[this.blocks.length - 1].x + this.blocks[this.blocks.length - 1].width + BLOCK_GAP;
				}

				this.blocks.push(new Block(this.ctx, this.canvas, nextX));							
			}

			this.draw = function() {

        		this.hero.draw();

				for(var i = 0; i < this.blocks.length; i++) {					


					var blockXRange = this.blocks[i].x + this.blocks[i].width;

			        // DRAW BLOCK
					//if(blockXRange > 0) {

						
					//} else {
					/*	console.log(this.blocks[i].x);
						this.blocks.splice(i, 1);
						console.log("deleted" + i);
					}
					
					// Player before a Block
					if( (this.hero.posX + this.hero.width) < this.blocks[i].x && this.hero.posX > blockXRange ) {
						this.hero.blockGround = canvas.height;
						if(this.hero.grounded) {
							//this.hero.posY = 
						}
					}						
					*/
					// Player on a Block
					if((this.hero.posY + this.hero.height) >= this.blocks[i].height && ( this.hero.posX >= this.blocks[i].x && this.hero.posX <= blockXRange) )  {
						this.hero.blockGround = canvas.height - this.blocks[i].height;						
			     	}

			     	// GAP
			     	if( (this.hero.posX + this.hero.width) < this.blocks[i].x && this.hero.posX > blockXRange ) {
			     		if((this.hero.posY + this.hero.height <= this.blocks[i].y) && (this.hero.posX + this.hero.width) >= this.blocks[i].x) {
			     			this.hero.posY = canvas.height - this.hero.height;
			     			this.reset();
			     		}
			     	}

			     	// Hits ground
			        if(this.hero.posY + this.hero.height == canvas.height) {
			        	this.reset();
			        }

					// Draw Block
			     	if(blockXRange > 0) {
			     		if(this.speed < 5)
			     			this.speed += 0.0001;
						
						this.blocks[i].draw(this.speed);
					} else {
						// Delete if not visible anymore
						this.blocks.splice(i, 1);
					}
					
			     }
			    			
			}      

			this.reset = function() {
				counter = document.getElementById("counter");
				counter.value = 0;
				this.speed = 0.0001;	
				this.hero.posY = canvas.height - this.hero.height;				
			}

		}
		
  		// --------------------------------------------------
  		function init() {
  			canvas = document.getElementById("canvas");
  			context = canvas.getContext("2d");

  			counter = document.getElementById("counter");
  			counter.value = 0;

  			context.font = "12pt Arial";

  			HEIGHT = canvas.height;
  			WIDTH = canvas.width;		

  			bg_cloud = new Image();
  			bg_cloud.src = "bg_cloud.png";

  			setInterval(draw, 10);
  			setInterval(generate, 500);
  		}


  		// --------------------------------------------------
  		function generate() {
  			level.generateBlock();  			
  		}

  		var cloudMoveX = 0;
  		function draw() {

  			context.clearRect(0, 0, WIDTH, HEIGHT);  	
  			
  			cloudMoveX -= .1;
  			if(cloudMoveX <= -600.0) {
  				cloudMoveX = 0;
  			}
  			
  			context.drawImage(bg_cloud, cloudMoveX , 0);
  					
  			// HERO
  			level.draw();
  			counter.value = parseInt(counter.value) + 1;

  			context.fillStyle = "#0000FF";
  			context.fillText(counter.value, 5, 15);

  		}

  		// --------------------------------------------------
  		function onKeyDown(evt) {	
  			switch (evt.keyCode) {
  				case 39:    					
    					level.hero.right = true;
    					break;
  				case 37:
  						level.hero.left = true;
  						break;
  				case 38:
  						level.hero.grounded = false;
  						break;
  			}
		}
		
		function onKeyUp(evt) {
  			switch (evt.keyCode) {
  				case 39:
    					level.hero.right = false;
    					break;
  				case 37:
  						level.hero.left = false;
  						break;  				
  			}
		}

		// --------------------------------------------------
  		$(document).ready(function() {
  			init();
  			level = new Level(context, canvas);
  		});

  		$(document).keydown(onKeyDown);
		$(document).keyup(onKeyUp);

</script>

<input type="hidden" id="counter" value="1" />
<canvas id="canvas" width="600" height="300">Your browser doesnt know html5 canvas	</canvas>

</body>
</html>